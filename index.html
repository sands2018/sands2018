<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<style>

td 
{
	text-align: center;
	vertical-align: middle;
	cursor: pointer;
}

.kbspace1
{
    padding: 0; margin: 0; border: 0; height: 50px;
    background: #ffffff;
    background: -webkit-linear-gradient(rgba(255,255,255,0),rgba(255,255,255,1));
    background: -moz-linear-gradient(top,rgba(255,255,255,0) 0%,rgba(255,255,255,1) 100%); /*FireFox*/
    background: -o-linear-gradient(top,rgba(255,255,255,0) 0%,rgba(255,255,255,1) 100%);  /* Opear */
    background: -ms-linear-gradient(rgba(255,255,255,0),rgba(255,255,255,1)); /*IE10及IE10+*/
}

.kbspace2
{
    padding: 0; margin: 0; height: 20px; border: 1px solid white;
    background-color: white; filter: alpha(Opacity=100); -moz-opacity: 1; opacity: 1;
}

#divCover { font-size: 40px; }
#divNumbers { padding: 20px; }

#tblKeyboard, #tblGameBoard { border: 1px solid; }
#tblKeyboard td, #tblGameBoard td { font-size: 50px; border: 1px solid; }
#tblKeyboard td { width: 110px; height: 105px; }
#tblGameBoard td { width: 95px; height: 95px; }

.tdHide { font-family: Arial }
#tblKeyboard #tdKSwitch, #tblGameBoard #tdBSwitch { font-size: 40px }

#tblQueue td { width: 58px; height: 58px; font-size: 36px; }

.bttn 
{
	width: 123px;
	height: 60px;
    line-height: 60px;
    text-align: center;
    vertical-align: middle;
	font-size: 36px;
    border: 1px solid white;
}

.title_c,.value_c { padding: 8px 0px; border: 1px solid;}
.title_c { font-size: 36px; width: 100px; color: #403000 }
.value_c { font-size: 40px; width: 80px; border-left: 0; }
.space_c { font-size: 10px; width: 23px; }

#divColumns { margin-bottom: 8px; font-size: 40px; padding: 0 10px; }  
.ColumnsCount { font-size: 44px; color: #dd8877; font-weight: bold }
.ColumnNormal { background-color: white; }
.ColumnHighlight { background-color: #f8ebd8; }

#tblDivPopupTitleBar td { border: 1px solid #dfbc33; border-right: 0; font-size: 40px }
#tblDivPopupTitleBar td:first-child { border-left: 0 }
#tblStatsFinally, #tblStatsNumCount { width: 100%; border: 1px solid #dfbc33 }  
#tblStatsFinally { border-left: 0; border-right: 0 }  
#tblStatsNumCount { border-left: 0; border-right: 0; border-top: 0 }  
#tblStatsFinally td { padding: 0 10px; font-size: 40px }
#tblStatsFinally td.tdSFTitle, #tblStatsNumCount td.tdSFTitle { color: #ab8b30; border-left: 1px solid #dfbc33 }
#tblStatsFinally td:first-child { border-left: 0 }
#tblStatsFinally td.tdSFPercent { color: #888888 }

#tblStatsIntervals { border: 1px solid #8f8f8f; border-bottom: 0; width: 100%; margin-bottom: 8px }
#tblStatsIntervals td { border-bottom: 1px solid #8f8f8f; font-size: 36px; padding: 3px 8px; text-align: center; }
#tblStatsIntervals td:first-child { border-right: 1px solid #8f8f8f; width: 100px; text-align: center; } 
#divStatsInterval0, #divStatsInterval1
{  
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%; 
    height: 48px;
    font-size: 36px;
}
#tblStatsIntervals .tdStatsInterval { text-align: left; }
#tblStatsIntervals .tdTotal { font-family:Arial; font-size: 40px; color: #dd8877; font-weight: bold; padding: 0px 18px } 
#tblStatsIntervals .tdZero { font-family:Arial; font-size: 40px; color: #8fc38f; font-weight: bold; padding: 0px 18px }
#tblStatsIntervals .txtZero { color: #83aa83 }

#tblStatsNumCount td { font-size: 40px; padding: 2px 10px }  
#tblStatsGroups { border-top: 1px solid #8f8f8f; width: 100% }
#tblStatsGroups td { font-size: 36px; text-align: left; padding-left: 12px; border-bottom: 1px solid #8f8f8f; }
#tblStatsGroups #tdSGButtons { padding: 0; border-bottom: 0; text-align: right; }
#tblSGButtons { width: 100% }
#tblSGButtons td, #tblSNCButtons td { font-size: 40px; border: 1px solid #AA8833; padding: 5px 28px;  width: 150px; text-align: center; }
.SGCNumber { font-size: 40px; color: #dd8877; font-weight: bold }

table.tblGameSum td { font-size: 36px; padding: 0 20px; }
table.tblGameSum { width: 100%; border: 1px solid #8f8f8f; }
table.tblGameSum #trGameSumTitle td { border-bottom: 1px solid #8f8f8f; } 
.tblGame { border: #8f8f8f 1px solid; margin-bottom: 18px; }
table.tblGame td { font-size: 36px; }
tr.trTitle td { color: #434343; padding: 0px 30px; }
tr.trItems td { text-align: center; padding: 0px 20px; border-top: #8f8f8f 1px solid; }  
tr.trActive td { color: black; }
tr.trWon td, .tdWon { color: #c37f7f; }
tr.trDrew td, .tdDrew { color: #939393; }
tr.trLost td, .tdLost { color: #7fc37f; }

#divImportExport
{ 
    position:fixed; top: 0px; z-index:9999; width: 100%; height: 100%; 
    background-color:white; 
}
#tdImportExportTitle { font-size: 36px; padding: 10px; background-color: #EEE8D3; }
#txtClipboard { font-size: 36px; border: 0 } 
#tblImportExport .tdSpec { font-size: 36px; text-align: left; padding: 8px 0 3px 0; }
#tblImportExport #tdTxt { border: 1px solid #AA8833; }
#tblPanelButtons td { border: 1px solid #AA8833; }
.bttnImportExport {	width: 280px; height: 70px }

</style>

<script language="javascript">

    /* z-index:
        0     - main div;
        99   - number queue;
        901  - div stats finally
        999  - cover;
        3001 - show gameboard/keyboard
        3002 - gameboard;
        3003 - keyboard
        9999 - div import/export
    */

    // styles: ----------------------------------------------------------------

    var g_s_theme_id = 1;

    var g_astrNumberColor =
    [
	    "g",
        "r", "b", "r", "b", "r", "b", "r", "b", "r", "b", "b", "r",
	    "b", "r", "b", "r", "b", "r", "r", "b", "r", "b", "r", "b",
	    "r", "b", "r", "b", "b", "r", "b", "r", "b", "r", "b", "r"
    ];

    // board border color:
    var g_s_c_board_b = ["#dfbc33", "#dfbc33", "white"];

    // number text color:
    var g_s_c_num = ["white", "#434343", "#f3f3f3"];

    // number background color:
    var g_s_c_num_bk_g = ["#35A300", "white", "white"]; // green
    var g_s_c_num_bk_r = ["#CC2200", "white", "white"]; // red
    var g_s_c_num_bk_b = ["#222222", "white", "white"]; // black
    var g_s_c_num_bk_s = ["#35A300", "white", "white"]; // switch

    // queue background color:
    var g_s_c_que_bk_g = ["35A300", "#D3EED3", "white"]; // green
    var g_s_c_que_bk_r = ["CC2200", "white", "white"]; // red
    var g_s_c_que_bk_b = ["222222", "#EAEAEA", "white"]; // black

    // queue border color:
    var g_s_c_que_b_g = ["white", "#CCFFCC", "white"]; 
    var g_s_c_que_b_r = ["white", "#FFDDAA", "white"]; 
    var g_s_c_que_b_b = ["white", "#DDDDDD", "white"]; 

    // button background color:
    var g_s_c_btn_bk_enabled = ["#008838", "white", "white"];
    var g_s_c_btn_bk_disabled = ["#888888", "white", "white"];

    // button text color:
    var g_s_c_btn_enabled = ["white", "#AA8833", "#f3f3f3"];
    var g_s_c_btn_disabled = ["white", "BBBBBB", "#f3f3f3"];

    // button border color:
    var g_s_c_btn_b_enabled = ["white", "#AA8833", "white"];
    var g_s_c_btn_b_disabled = ["white", "BBBBBB", "white"];

    // 3c3r color
    var g_s_c_3c3r = ["black", "black", "#f3f3f3"]; // text color
    var g_s_c_3c3r_bk = ["#EBE3CB", "white", "white"]; // background color
    var g_s_c_3c3r_t_bk = ["#DFD7CB", "white", "white"]; // title background color

    // 3c3r >=5 color
    var g_s_c_3c3r_5 = ["white", "black", "#f3f3f3"]; // text color
    var g_s_c_3c3r_5_bk = ["rgb(158,118,200)", "#EEEEEE", "white"]; // background color
    var g_s_c_3c3r_5_t_bk = ["rgb(128,88,158)", "#DDDDDD", "white"]; // title background color

    // 3c3r >=6 background color
    var g_s_c_3c3r_6 = ["white", "black", "#f3f3f3"]; // text color
    var g_s_c_3c3r_6_bk = ["rgb(0,128,255)", "#EBE3CB", "white"]; // background color
    var g_s_c_3c3r_6_t_bk = ["rgb(0,93,218)", "#DFD7CB", "white"]; // title background color

    // 3c3r border color
    var g_s_c_3c3r_b = ["white", "#AA8833", "white"];

    // stats groups active button background color
    var g_s_c_sg_bk_active = "#EBE3CB";

    // elements style need to be changed
    var g_s_ctlid_kbtd = ["tdBEsc", "tdBSwitch", "tdBHide", "tdKEsc", "tdKSwitch", "tdKHide"];

    // global variables: ------------------------------------------------------

    var COOKIE_BACKUP = "COOKIE_BACKUP";
    var COOKIE_KEYBOARD_ID = "KeyboardID";
    var COOKIE_COLUMNS_STATUS = "ColumnsStatus";
    var COOKIE_SG_COUNT_IDX = "StatsGroupCountIdx";
    var COOKIE_STATSINTV_STATUS = "StatsIntvStatus";
    var COOKIE_STATSGROUP_STATUS = "StatsGroupStatus";

    var MAX_NUM_COUNT = 10000;
    var QUEUE_MAX_COUNT = 100;
    var QUEUE_LINE_NUM_COUNT = 15;
    var GAME_SHOW_ITEM_COUNT = 20;
    var STATS_GROUPS_COUNTS = [20, 40, 60, 80, 100, 99999];
    var STATS_NUMCOUNT_COUNTS = [40, 100, 99999];

    var g_anQueueNum = [];
    var g_nQueueIdx = -1;
    var g_nNoZeroNumCount = 0;

    var g_an3C3R = [];
    var g_anIdx3C3R = [];

    var g_anColumnsStart = [1, 4, 7, 10, 13, 16, 19, 22, 25, 28, 31];

    var g_nEscapeStatus = 0;
    var g_strKeyboardID = "B";
    var g_nColumnsStatus = 0;
    var g_nExpandStatus = 0;
    var g_nShowInputStatus = 1;
    var g_nSGCountIdx = 1;
    var g_nStatsIntervalStatus = 0; // 0 - 全部显示， 1 - 第一行不显示， 2 - 第一行、最后一行不显示
    var g_nStatsGroupStatus = 1;
    var g_nPopupStatsMiscStatus = 0;
    var g_nSNCCountIdx = 1;

    var g_StatsInterval;
    var g_aGame = [];

    var g_aGameRule = [];

    var g_t_an3C3RCount = [0, 0, 0, 0, 0, 0];
    var g_t_anIdx3C3RCount = [0, 1, 2, 3, 4, 5];

    var g_t_anColumnsCount = [0,0,0,0,0,0,0,0,0,0,0];
    var g_t_anIdxColumnsCount = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10];

    var g_astrPopupDivID = ["divStatsMisc"];

    // basic: -----------------------------------------------------------------

    function InitGlobalVariables()
    {
        if (g_anQueueNum.length > 0)
            g_anQueueNum.splice(0, g_anQueueNum.length);

        g_nEscapeStatus = 0;
        g_nQueueIdx = -1;
        g_nNoZeroNumCount = 0;

        g_an3C3R.splice(0, g_an3C3R.length);
        g_anIdx3C3R.splice(0, g_anIdx3C3R.length);

        g_nExpandStatus = 0;
        g_nShowInputStatus = 1;

        g_nStatsNumCountSel = 1;

        g_aGame = [];
    }

    function OnTest()
    {
    }

    function GetNumCol(num)
    {
        return Math.floor((num - 1) / 12);
    }

    function GetNumRow(num)
    {
        var nRow = num % 3;
        if (nRow == 1)
        {
            nRow = 2;
        }
        else if (nRow == 2)
        {
            nRow = 1;
        }

        return nRow;
    }

    function GetNumColumn(num)
    {
        var anCol = [];

        anCol[0] = Math.floor((num - 1) / 6) * 2;

        if ((num > 3) && (num < 34))
            anCol[1] = Math.floor((num - 4) / 6) * 2 + 1;
        else
            anCol[1] = -1;

        return anCol;
    }

    function GetColumnSpec(nIdx)
    {
        return g_anColumnsStart[nIdx].toString() + "-" + (g_anColumnsStart[nIdx] + 5).toString();
    }

    function GetNumberColor()
    {
        return g_s_c_num[g_s_theme_id];
    }

    function GetNumberBackgroundColor(num)
    {
        var strColor = g_astrNumberColor[num];

        if (strColor == "r")
        {
            return g_s_c_num_bk_r[g_s_theme_id];
        }
        else if (strColor == "b")
        {
            return g_s_c_num_bk_b[g_s_theme_id];
        }
        else
        {
            return g_s_c_num_bk_g[g_s_theme_id];
        }
    }

    function GetQueueNumberBackgroundColor(num)
    {
        var strColor = g_astrNumberColor[num];

        if (strColor == "r")
        {
            return g_s_c_que_bk_r[g_s_theme_id];
        }
        else if (strColor == "b")
        {
            return g_s_c_que_bk_b[g_s_theme_id];
        }
        else
        {
            return g_s_c_que_bk_g[g_s_theme_id];
        }
    }

    function GetQueueNumberBorderColor(num)
    {
        var strColor = g_astrNumberColor[num];

        if (strColor == "r")
        {
            return g_s_c_que_b_r[g_s_theme_id];
        }
        else if (strColor == "b")
        {
            return g_s_c_que_b_b[g_s_theme_id];
        }
        else
        {
            return g_s_c_que_b_g[g_s_theme_id];
        }
    }

    function DoSetCookie(c_name, value, expiredays)
    {
        if (expiredays == null)
        {
            document.cookie = c_name + "=" + escape(value);
            return;
        }

        var exdate = new Date()
        exdate.setDate(exdate.getDate() + expiredays)
        document.cookie = c_name + "=" + escape(value) + ";expires=" + exdate.toGMTString();
    }

    function SetCookie(c_name, value)
    {
        DoSetCookie(c_name, value, 9999);
    }

    function GetCookie(c_name)
    {
        if (document.cookie.length > 0)
        {
            var c_start = document.cookie.indexOf(c_name + "=")
            if (c_start != -1)
            {
                c_start = c_start + c_name.length + 1
                var c_end = document.cookie.indexOf(";", c_start)
                if (c_end == -1) c_end = document.cookie.length
                return unescape(document.cookie.substring(c_start, c_end))
            }
        }
        return ""
    }

    // classes: ---------------------------------------------------------------

    function CPair()
    {
        this.value1 = -1;
        this.value2 = -1;
    }

    function CGameItem()
    {
        this.nIdx = 1;
        this.nBet3C3R = -1; // 0 ~ 2: columns; 3 ~ 5: rows
        this.nDistance = 0;
        this.nRound = 0;
        this.nMoney = 0;
        this.nStatus = 1;
        this.nHit = 0;
    }

    function CGame(nIdxRule)
    {
        this.nIdxRule = nIdxRule;

        this.nCount = 0;
        this.nMoney = 0;

        this.nCountCompleted = 0;
        this.nCountWon = 0;
        this.nCountDrew = 0;
        this.nCountLost = 0;
        this.nCountHit = 0;

        this.nBalance = 0;
        this.aItem = [];

        this.nShowStatus = 0;

        this.AfterItemEnds = function(item)
        {
            this.nCountCompleted++;

            if (item.nMoney > 0)
                this.nCountWon++;
            else if (item.nMoney == 0)
                this.nCountDrew++;
            else
                this.nCountLost++;

            if (item.nHit == 1)
                this.nCountHit++;

            this.nBalance += item.nMoney;
        }

        this.BeforeItemRestores = function (item)
        {
            this.nCountCompleted--;

            if (item.nMoney > 0)
                this.nCountWon--;
            else if (item.nMoney == 0)
                this.nCountDrew--;
            else
                this.nCountLost--;

            if (item.nHit == 1)
                this.nCountHit--;

            this.nBalance -= item.nMoney;
        }

        this.Add = function (item)
        {
            this.aItem[this.nCount] = item;
            this.aItem[this.nCount].nIdx = this.nCount;
            this.nCount++;
        }

        this.RemoveAt = function(nIdx)
        {
            if((this.nCount <= 0) || (nIdx >= this.nCount))
            {
                return;
            }
            for (var n = nIdx; n < (this.nCount - 1) ; ++n)
            {
                this.aItem[n] = this.aItem[n + 1];
                this.aItem[n].nIdx--;
            }
            this.aItem[this.nCount - 1] = null;
            this.nCount--;
        }

        this.RemoveAll = function()
        {
            for (var n = 0; n < this.nCount; ++n)
            {
                this.aItem[n] = null;
            }
            this.nCount = 0;
        }

        this.AddNum = function(num)
        {
            // add distance for all item:

            for (var n = 0; n < this.nCount; ++n)
            {
                this.aItem[n].nDistance++;
            }

            // number 0:

            if (num == 0)
            {
                this.nMoney = this.nBalance;
                for(var n = 0; n < this.nCount; ++n)
                {
                    if (this.aItem[n].nStatus == 0)
                        continue;

                    this.aItem[n].nMoney -= g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1];
                    this.nMoney += this.aItem[n].nMoney;
                }

                return;
            }

            var nNumCol = GetNumCol(num);
            var nNumRow = GetNumRow(num);

            var anNum3C3R = [nNumCol, nNumRow + 3];

            // whether hitted by column or row:

            for (var nn = 0; nn < 2; ++nn)
            {
                for (var n = 0; n < this.nCount; ++n)
                {
                    if (this.aItem[n].nStatus == 0)
                        continue;

                    if (this.aItem[n].nBet3C3R == anNum3C3R[nn])
                    {
                        this.aItem[n].nMoney += g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1] * 3;
                        this.aItem[n].nStatus = 0;
                        this.aItem[n].nHit = 1;

                        this.AfterItemEnds(this.aItem[n]);
                    }
                }
            }

            // increase round, see if it ends:

            for (var n = 0; n < this.nCount; ++n)
            {
                if (this.aItem[n].nStatus == 0)
                    continue;

                if (this.aItem[n].nRound == g_aGameRule[this.nIdxRule].nRound)
                {
                    this.aItem[n].nStatus = 0;
                    this.aItem[n].nHit = 0;

                    this.AfterItemEnds(this.aItem[n]);
                }
                else
                {
                    this.aItem[n].nRound++;
                    this.aItem[n].nMoney -= g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1];
                }
            }

            // whether a new game start:

            for (var n = 0; n < 6; ++n)
            {
                if (g_an3C3R[n] == g_aGameRule[this.nIdxRule].nSkip)
                {
                    var item = new CGameItem();
                    item.nBet3C3R = n;
                    item.nDistance = 0;
                    item.nRound = 1;
                    item.nMoney = -g_aGameRule[this.nIdxRule].anBet[0];
                    item.nStatus = 1;

                    this.Add(item);
                }
            }

            // calculate realtime money:

            this.nMoney = this.nBalance;
            for(var n = 0; n < this.nCount; ++n)
            {
                if (this.aItem[n].nStatus == 0)
                    continue;

                this.nMoney += this.aItem[n].nMoney;
            }
        }


        this.DeleteNum = function (num)
        {
            // decrease distance for all item:

            for (var n = 0; n < this.nCount; ++n)
            {
                this.aItem[n].nDistance--;
            }

            // number 0:

            if (num == 0)
            {
                this.nMoney = this.nBalance;
                for (var n = 0; n < this.nCount; ++n)
                {
                    if (this.aItem[n].nStatus == 0)
                        continue;

                    this.aItem[n].nMoney += g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1];
                    this.nMoney += this.aItem[n].nMoney;
                }

                return;
            }

            var nNumCol = GetNumCol(num);
            var nNumRow = GetNumRow(num);

            var anNum3C3R = [nNumCol, nNumRow + 3];

            // whether hitted by column or row:

            for (var nn = 0; nn < 2; ++nn)
            {
                for (var n = 0; n < this.nCount; ++n)
                {
                    if (this.aItem[n].nStatus == 0)
                    {
                        if (this.aItem[n].nBet3C3R == anNum3C3R[nn])
                        {
                            if (this.aItem[n].nDistance == (this.aItem[n].nRound - 1))
                            {
                                this.BeforeItemRestores(this.aItem[n]);

                                this.aItem[n].nMoney -= g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1] * 3;
                                this.nMoney -= g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1] * 3;

                                this.aItem[n].nStatus = 1;
                                this.aItem[n].nHit = 10; // temp value
                            }
                        }
                    }
                }
            }

            // decrease round:

            for (var n = this.nCount - 1; n >= 0; --n)
            {
                if (this.aItem[n].nHit == 10)
                {
                    this.aItem[n].nHit = 0;
                }
                else
                {
                    if (this.aItem[n].nStatus == 0)
                    {
                        if (this.aItem[n].nDistance == (this.aItem[n].nRound - 1))
                        {
                            this.BeforeItemRestores(this.aItem[n]);

                            this.aItem[n].nStatus = 1;
                            this.aItem[n].nHit = 0;
                        }
                    }
                    else 
                    {
                        this.aItem[n].nMoney += g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1];
                        this.nMoney += g_aGameRule[this.nIdxRule].anBet[this.aItem[n].nRound - 1];

                        this.aItem[n].nRound--;
                        if (this.aItem[n].nRound == 0)
                            this.RemoveAt(n);
                    }
                }
            }

            // calculate realtime money:

            this.nMoney = this.nBalance;
            for (var n = 0; n < this.nCount; ++n)
            {
                if (this.aItem[n].nStatus == 0)
                    continue;

                this.nMoney += this.aItem[n].nMoney;
            }
        }
    }

    function CStatsInterval()
    {
        this.anFailedRound = [];
        this.anFailedRound[0] = 4;
        this.anFailedRound[1] = 6;

        this.anRound = [];

        this.anRound[0] = 4;
        this.anRound[1] = 5;
        this.anRound[2] = 6;
        this.anRound[3] = 7;
        this.anRound[4] = 8;
        this.anRound[5] = 9;

        this.anNotYetCount = [];
        this.anNotYetCount[0] = 0;
        this.anNotYetCount[1] = 0;
        this.anNotYetCount[2] = 0;
        this.anNotYetCount[3] = 0;
        this.anNotYetCount[4] = 0;
        this.anNotYetCount[5] = 0;

        this.anFailed = [];
        this.anFailed[0] = [0, 0, 0, 0, 0, 0];
        this.anFailed[1] = [0, 0, 0, 0, 0, 0];

        // 11 -> 30 and above, maintained outside this class:

        this.anLargeCount = [];
        this.anZero = [];

        this.anExpandStatus = [0, 0];

        this.AddNum = function (num, bReal)
        {
            // 0:

            if (num == 0)
            {
                if (bReal)
                    this.anZero.push(0);

                return;
            }

            if (bReal)
            {
                var nIdxLast = this.anZero.length - 1;
                if (nIdxLast < 0)
                {
                    this.anZero.push(1);
                }
                else if (this.anZero[nIdxLast] == 0)
                {
                    this.anZero.push(1);
                }
                else
                {
                    this.anZero[nIdxLast]++;
                }
            }

            var nCount = this.anRound.length;

            for (var nn = 0; nn < 6; ++nn)
            {
                // whether hit start:

                for (var n = 0; n < nCount; ++n)
                {
                    if (g_an3C3R[nn] == this.anRound[n])
                    {
                        this.anNotYetCount[n]++;
                    }
                }

                // whether hit end:

                for (var n = 0; n < nCount; ++n)
                {
                    var nRound = this.anFailedRound.length;

                    for (var r = 0; r < nRound; ++r)
                    {
                        if ((g_an3C3R[nn] == (this.anRound[n] + this.anFailedRound[r])))
                        {
                            this.anFailed[r][n]++;
                        }
                    }
                }
            }
        }

        this.DeleteNum = function(num)
        {
            if (num == 0)
            {
                this.anZero.pop();
                return;
            }

            var anCountBak = [];
            var anFailedBak = [];
            anFailedBak[0] = [];
            anFailedBak[1] = [];

            var anLargeCountBak = [];

            var nCount = this.anRound.length;

            for (var n = 0; n < nCount; ++n)
            {
                anCountBak[n] = this.anNotYetCount[n];

                for (var nn = 0; nn < this.anFailedRound.length; ++nn)
                {
                    anFailedBak[nn][n] = this.anFailed[nn][n];
                }
            }

            this.AddNum(num, false);
            
            for (var n = 0; n < nCount; ++n)
            {
                this.anNotYetCount[n] = anCountBak[n] - (this.anNotYetCount[n] - anCountBak[n]);

                for (var nn = 0; nn < this.anFailedRound.length; ++nn)
                {
                    this.anFailed[nn][n] = anFailedBak[nn][n] - (this.anFailed[nn][n] - anFailedBak[nn][n]);
                }
            }

            var nIdxLast = this.anZero.length - 1;
            if (nIdxLast >= 0)
            {
                if(this.anZero[nIdxLast] == 1)
                {
                    this.anZero.pop();
                }
                else
                {
                    this.anZero[nIdxLast]--;
                }
            }
        }
    }

    function InitStatsInterval()
    {
        g_StatsInterval = new CStatsInterval();

        for(var n = 0; n < 20; ++ n)
        {
            g_StatsInterval.anLargeCount[n] = 0;
        }
    }

    function CGameRule()
    {
        this.nSkip;
        this.nRound;
        this.anBet = [];
        this.strSpec;
    }

    function InitGameRuleList()
    {
        var rule0 = new CGameRule();
        rule0.nSkip = 6;
        rule0.nRound = 6;
        rule0.anBet = [10, 10, 10, 20, 20, 30];
        rule0.strSpec = "WW_6_111223";

        var rule1 = new CGameRule();
        rule1.nSkip = 5;
        rule1.nRound = 6;
        rule1.anBet = [10, 10, 10, 20, 20, 30];
        rule1.strSpec = "WW_5_111223";

        var rule2 = new CGameRule();
        rule2.nSkip = 6;
        rule2.nRound = 4;
        rule2.anBet = [10, 20, 30, 40];
        rule2.strSpec = "WW_6_1234";

        var rule3 = new CGameRule();
        rule3.nSkip = 7;
        rule3.nRound = 4;
        rule3.anBet = [10, 20, 30, 40];
        rule3.strSpec = "WW_7_1234";

        var rule4 = new CGameRule();
        rule4.nSkip = 6;
        rule4.nRound = 5;
        rule4.anBet = [10, 20, 30, 40, 50];
        rule4.strSpec = "WW_6_12345";

        var rule5 = new CGameRule();
        rule5.nSkip = 7;
        rule5.nRound = 5;
        rule5.anBet = [10, 20, 30, 40, 50];
        rule5.strSpec = "WW_7_12345";

        var rule6 = new CGameRule();
        rule6.nSkip = 5;
        rule6.nRound = 4;
        rule6.anBet = [10, 20, 40, 80];
        rule6.strSpec = "WZS_5_1248";

        var rule7 = new CGameRule();
        rule7.nSkip = 5;
        rule7.nRound = 4;
        rule7.anBet = [20, 30, 40, 60];
        rule7.strSpec = "WZS_5_2346";

        var rule8 = new CGameRule();
        rule8.nSkip = 3;
        rule8.nRound = 3;
        rule8.anBet = [10, 20, 40];
        rule8.strSpec = "WZS_3_124";

        var rule9 = new CGameRule();
        rule9.nSkip = 4;
        rule9.nRound = 3;
        rule9.anBet = [10, 20, 40];
        rule9.strSpec = "WZS_4_124";

        var rule10 = new CGameRule();
        rule10.nSkip = 5;
        rule10.nRound = 3;
        rule10.anBet = [10, 20, 40];
        rule10.strSpec = "WZS_5_124";

        var rule11 = new CGameRule();
        rule11.nSkip = 6;
        rule11.nRound = 3;
        rule11.anBet = [10, 20, 40];
        rule11.strSpec = "WZS_6_124";

        var rule12 = new CGameRule();
        rule12.nSkip = 5;
        rule12.nRound = 4;
        rule12.anBet = [10, 20, 30, 50];
        rule12.strSpec = "WZS_5_1235";

        var rule13 = new CGameRule();
        rule13.nSkip = 6;
        rule13.nRound = 4;
        rule13.anBet = [10, 20, 30, 50];
        rule13.strSpec = "WZS_6_1235";

        g_aGameRule[0] = rule6;
        g_aGameRule[1] = rule7;
        g_aGameRule[2] = rule2;
        g_aGameRule[3] = rule3;
        g_aGameRule[4] = rule4;
        g_aGameRule[5] = rule5;
        g_aGameRule[6] = rule0;
        g_aGameRule[7] = rule1;
        g_aGameRule[8] = rule8;
        g_aGameRule[9] = rule9;
        g_aGameRule[10] = rule10;
        g_aGameRule[11] = rule11;
        g_aGameRule[12] = rule12;
        g_aGameRule[13] = rule13;
    }

    function InitGame()
    {
        for (var n = 0; n < g_aGameRule.length; ++n)
        {
            var game = new CGame(n);
            game.nCount = 0;

            g_aGame[n] = game;
        }
    }

    function InitStyles()
    {
        var tblK = document.getElementById("tblKeyboard");
        tblK.style.borderColor = g_s_c_board_b[g_s_theme_id];

        var tblB = document.getElementById("tblGameBoard");
        tblB.style.borderColor = g_s_c_board_b[g_s_theme_id];

        for (var n = 0; n <= 36; ++n)
        {
            var tdK = document.getElementById("tdK" + n.toString());
            tdK.style.backgroundColor = GetNumberBackgroundColor(n);
            tdK.style.borderColor = g_s_c_board_b[g_s_theme_id];
            tdK.style.color = GetNumberColor();

            var tdB = document.getElementById("tdB" + n.toString());
            tdB.style.backgroundColor = GetNumberBackgroundColor(n);
            tdB.style.borderColor = g_s_c_board_b[g_s_theme_id];
            tdB.style.color = GetNumberColor();
        }

        for (var n = 0; n < g_s_ctlid_kbtd.length; ++n)
        {
            var td = document.getElementById(g_s_ctlid_kbtd[n]);
            td.style.backgroundColor = g_s_c_num_bk_s[g_s_theme_id];
            td.style.borderColor = g_s_c_board_b[g_s_theme_id];
            td.style.color = g_s_c_num[g_s_theme_id];
        }
    }

    // functions: -------------------------------------------------------------

    function Sort(anValue, anIndex, bAsend)
    {
        var nCount = anValue.length;

        var bChanged = false;
        do
        {
            bChanged = false;

            for (var n = 0; n < nCount - 1; ++n)
            {
                if ((bAsend && (anValue[anIndex[n]] > anValue[anIndex[n + 1]]))
                    || (!bAsend && (anValue[anIndex[n]] < anValue[anIndex[n + 1]])))
                {
                    tmp = anIndex[n];
                    anIndex[n] = anIndex[n + 1];
                    anIndex[n + 1] = tmp;

                    bChanged = true;
                }
            }
        } while (bChanged);
    }

    function GetQueueItemBorderStyle(num)
    {
        return "1px solid " + GetQueueNumberBorderColor(num);
    }

    ///////////////////////////////////////////////////////////////////////////

    function Calc_StatsGroupsCount()
    {
        for (var n = 0; n < 6; ++n)
        {
            g_t_an3C3RCount[n] = 0;
            g_t_anIdx3C3RCount[n] = n;
        }

        var nCalcCount = STATS_GROUPS_COUNTS[g_nSGCountIdx];
        var nCount = 0;

        for (var n = g_nQueueIdx; n >= 0; --n)
        {
            if (g_anQueueNum[n] == 0)
                continue;

            var numQ = g_anQueueNum[n];
            var nCol = GetNumCol(numQ);
            var nRow = GetNumRow(numQ);

            g_t_an3C3RCount[nCol]++;
            g_t_an3C3RCount[nRow + 3]++;

            ++nCount;
            if (nCount >= nCalcCount)
                break;
        }

        Sort(g_t_an3C3RCount, g_t_anIdx3C3RCount, true);
    }

    function NumberString_StatsGroupsCount(nNum)
    {
        return "<span class='SGCNumber'>" + nNum.toString() + "</span>"
    }

    function Show_StatsGroupsCount()
    {
        var div = document.getElementById("divStatsGroups");
        var strDisplay = "";
        if (g_nQueueIdx < 0)
            strDisplay = "none";
        div.style.display = strDisplay;

        var tdCol = document.getElementById("tdStatsGroupsCol");
        var strHtml = "";
        var bFirst = true;
        for (var n = 0; n < 6; ++n)
        {
            var nIdx = g_t_anIdx3C3RCount[n];
            if (nIdx >= 3)
                continue;

            if (!bFirst)
                strHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            bFirst = false;

            strHtml += GetColRowSpec(nIdx) + "&nbsp;";
            strHtml += NumberString_StatsGroupsCount(g_t_an3C3RCount[nIdx]);
        }
        tdCol.innerHTML = strHtml;

        strHtml = "";
        var tdRow = document.getElementById("tdStatsGroupsRow");
        bFirst = true;
        for (var n = 0; n < 6; ++n)
        {
            var nIdx = g_t_anIdx3C3RCount[n];
            if (nIdx < 3)
                continue;

            if (!bFirst)
                strHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            bFirst = false;

            strHtml += GetColRowSpec(nIdx) + "&nbsp;";
            strHtml += NumberString_StatsGroupsCount(g_t_an3C3RCount[nIdx]);
        }
        tdRow.innerHTML = strHtml;

        strHtml = "";
        var tdAll = document.getElementById("tdStatsGroupsAll");
        bFirst = true;
        for (var n = 0; n < 6; ++n)
        {
            var nIdx = g_t_anIdx3C3RCount[n];

            if (!bFirst)
                strHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            bFirst = false;

            strHtml += GetColRowSpec(nIdx) + "&nbsp;";
            strHtml += NumberString_StatsGroupsCount(g_t_an3C3RCount[nIdx]);
        }
        tdAll.innerHTML = strHtml;
    }

    function Show_Queue()
    {
        var nStart = 0;
        if (g_nQueueIdx > QUEUE_MAX_COUNT)
            nStart = g_nQueueIdx - QUEUE_MAX_COUNT + 1;

        for (var n = nStart; n <= g_nQueueIdx; ++n)
        {
            var nn = (n - nStart);
            var nIdx = g_nQueueIdx - nn;

            var strIdTd = "td" + nn.toString();
		    var td = document.getElementById(strIdTd);
		    td.innerHTML = g_anQueueNum[nIdx];
		    td.style.backgroundColor = GetQueueNumberBackgroundColor(g_anQueueNum[nIdx]);
		    td.style.color = GetNumberColor();
		    td.style.border = GetQueueItemBorderStyle(g_anQueueNum[nIdx]);
        }

        for (var n = g_nQueueIdx + 1; n < QUEUE_MAX_COUNT; ++n)
	    {
		    var strIdTd = "td" + n.toString();
		    var td = document.getElementById(strIdTd);
		    td.innerHTML = "&nbsp;";
		    td.style.backgroundColor = "#FFFFFF";
		    td.style.border = "0";
        }

	    var nQueueRow = 0;

	    if (g_nQueueIdx >= 0)
        {
	        nQueueRow = Math.floor((g_nQueueIdx - nStart) / QUEUE_LINE_NUM_COUNT) + 1;
	    }

	    var nLineCount = (QUEUE_MAX_COUNT / QUEUE_LINE_NUM_COUNT).toFixed(0);

	    for (var n = 1; n <= nLineCount; ++n)
	    {
	        var strID = "trRow" + n.toString();
	        var tr = document.getElementById(strID);
	        if ((nQueueRow > 0) && ((n == 1) || ((n <= nQueueRow) && (g_nExpandStatus == 1))))
	            tr.style.display = "";
            else
	            tr.style.display = "none";
	    }
    }

    function Show_RefreshSysButtons()
    {
        var strBkClrDisabled = g_s_c_btn_bk_disabled[g_s_theme_id];
        var strBkClrEnabled = g_s_c_btn_bk_enabled[g_s_theme_id];

        var strClrDisabled = g_s_c_btn_disabled[g_s_theme_id];
        var strClrEnabled = g_s_c_btn_enabled[g_s_theme_id];

        var strBorderClrDisabled = g_s_c_btn_b_disabled[g_s_theme_id];
        var strBorderClrEnabled = g_s_c_btn_b_enabled[g_s_theme_id];

        var astrIDBttn = ["tdBttnTheme", "tdBttnRestart", "tdBttnDelete", "tdBttnRestore", "tdBttnExport", "tdBttnImport", "tdBttnStatsFinally"];
        var abEnabled = [];

        for (var n = 0; n < astrIDBttn.length; ++n)
        {
            abEnabled[n] = true;
        }

        if (g_nQueueIdx < 0)
        {
            abEnabled[1] = false; // restart
            abEnabled[2] = false; // delete
            abEnabled[4] = false; // export
            abEnabled[6] = false; // stats finally
        }
        else
        {
            abEnabled[3] = false; // restore
        }

        if (g_nQueueIdx < QUEUE_LINE_NUM_COUNT)
        {
            g_nExpandStatus = 0;
        }

        for (var n = 0; n < astrIDBttn.length; ++n)
        {
            var bttn = document.getElementById(astrIDBttn[n]);
            bttn.style.backgroundColor = abEnabled[n] ? strBkClrEnabled : strBkClrDisabled;
            bttn.style.color = abEnabled[n] ? strClrEnabled : strClrDisabled;
            bttn.style.borderColor = abEnabled[n] ? strBorderClrEnabled : strBorderClrDisabled;
        }
    }

    function Calc_3C3RAddNum(num)
    {
        if(num == 0) return;
	
        var nCol = GetNumCol(num);
        var nRow = GetNumRow(num);

        for (var n = 0; n < 6; ++n)
        {
            g_an3C3R[n]++;
        }

        // process g_StatsInterval.anLargeCount: ----------

        var anNum3C3R = [nCol, nRow + 3];

        for (var n = 0; n < 2; ++n)
        {
            var nCount = g_an3C3R[anNum3C3R[n]] - 1;
            if (nCount >= 11)
            {
                var nIdx = nCount - 11;
                if (nIdx >= 19)
                    nIdx == 19;

                g_StatsInterval.anLargeCount[nIdx]++;
            }
            g_an3C3R[anNum3C3R[n]] = 0;
        }
    }

    function Calc_3C3RDeleteNum(num)
    {
        --g_nQueueIdx;

        if (num == 0)
            return;

        var abOccur = [];

        for (var n = 0; n < 6; ++n)
        {
            g_an3C3R[n] = 0;
            g_anIdx3C3R[n] = n;
            abOccur[n] = false;
        }

        for (var n = g_nQueueIdx; n >= 0; --n)
        {
            var numQ = g_anQueueNum[n];
            if (numQ == 0) continue;

            var nCol = GetNumCol(numQ);
            var nRow = GetNumRow(numQ);

            var bChanged = false;

            for (var nn = 0; nn < 6; ++nn)
            {
                if(!abOccur[nn])
                {
                    if((nn == nCol) || (nn == (nRow + 3)))
                    {
                        abOccur[nn] = true;
                    }
                    else
                    {
                        g_an3C3R[nn]++;
                        bChanged = true;
                    }
                }
            }

            if (!bChanged)
                break;
        }

        // process g_StatsInterval.anLargeCount: ----------

        var nCol = GetNumCol(num);
        var nRow = GetNumRow(num);

        var anNum3C3R = [nCol, nRow + 3];

        for (var n = 0; n < 2; ++n)
        {
            var nCount = g_an3C3R[anNum3C3R[n]];
            if (nCount >= 11)
            {
                var nIdx = nCount - 11;
                if (nIdx >= 19)
                    nIdx == 19;

                g_StatsInterval.anLargeCount[nIdx]--;
            }
        }
    }

    function GetColRowSpec(nIdx3C3R)
    {
        var strSpec;

        if (nIdx3C3R < 3)
        {
            if (nIdx3C3R == 0)
                strSpec = "一组";
            else if (nIdx3C3R == 1)
                strSpec = "二组";
            else
                strSpec = "三组";
        }
        else
        {
            strSpec = (nIdx3C3R - 3 + 1).toString() + "行";
        }

        return strSpec;
    }

    function Show_3C3R()
    {
        // show:
        for (var n = 0; n < 6; ++n)
	    {
		    var strIdTd = "td3C3R" + n.toString();
		    var td = document.getElementById(strIdTd);
		    td.innerHTML = g_an3C3R[g_anIdx3C3R[n]];
		    strIdTd = "tdT3C3R" + n.toString();
		    var strTitle = GetColRowSpec(g_anIdx3C3R[n]);
		    var tdT = document.getElementById(strIdTd);
		    tdT.innerHTML = strTitle;

		    if (g_an3C3R[g_anIdx3C3R[n]] >= 5)
		    {
		        if (g_an3C3R[g_anIdx3C3R[n]] > 5)
                {
		            td.style.color = g_s_c_3c3r_6[g_s_theme_id];
		            tdT.style.color = g_s_c_3c3r_6[g_s_theme_id];
		            td.style.backgroundColor = g_s_c_3c3r_6_bk[g_s_theme_id];
		            tdT.style.backgroundColor = g_s_c_3c3r_6_t_bk[g_s_theme_id];
		        }
                else
		        {
		            td.style.color = g_s_c_3c3r_5[g_s_theme_id];
		            tdT.style.color = g_s_c_3c3r_5[g_s_theme_id];
		            td.style.backgroundColor = g_s_c_3c3r_5_bk[g_s_theme_id];
		            tdT.style.backgroundColor = g_s_c_3c3r_5_t_bk[g_s_theme_id];
                }
		        td.style.fontWeight = "bold";
            }
            else
		    {
		        td.style.color = g_s_c_3c3r[g_s_theme_id];
		        tdT.style.color = g_s_c_3c3r[g_s_theme_id];
		        td.style.backgroundColor = g_s_c_3c3r_bk[g_s_theme_id];
		        tdT.style.backgroundColor = g_s_c_3c3r_t_bk[g_s_theme_id];

		        td.style.fontWeight = "normal";
		    }

		    td.style.borderColor = g_s_c_3c3r_b[g_s_theme_id];
		    tdT.style.borderColor = g_s_c_3c3r_b[g_s_theme_id];
        }
    }

    function Calc_Columns()
    {
        var anCounting = [];

        for (var nn = 0; nn < g_anColumnsStart.length; ++nn)
        {
            g_t_anColumnsCount[nn] = 0;
            g_t_anIdxColumnsCount[nn] = nn;
            anCounting[nn] = 1;
        }

        if (g_nQueueIdx < 0)
            return;

        for(var n = g_nQueueIdx; n >= 0; --n)
        {
            var bChanged = false;

            if (g_anQueueNum[n] == 0)
                continue;

            var anColumn = GetNumColumn(g_anQueueNum[n]);

            for (var nn = 0; nn < g_anColumnsStart.length; ++nn)
            {
                if ((nn == anColumn[0]) || (nn == anColumn[1]))
                {
                    anCounting[nn] = 0;
                }
                else
                {
                    if(anCounting[nn] != 0)
                    {
                        ++g_t_anColumnsCount[nn];
                        bChanged = true;
                    }
                }
            }

            if (!bChanged)
                break;
        }

        Sort(g_t_anColumnsCount, g_t_anIdxColumnsCount, false);
    }

    function CheckHighlightColumns(aPair)
    {
        var anSelected = [];
        for (var n = 0; n < g_anColumnsStart.length; ++n)
        {
            anSelected[n] = 0;
        }

        for(var n1 = 0; n1 < g_anColumnsStart.length; ++n1)
        {
            var nIdx1 = g_t_anIdxColumnsCount[n1];
            if (g_t_anColumnsCount[nIdx1] < 5)
                break;
            
            if (anSelected[n1] != 0)
                continue;

            var nFound1 = nIdx1;
            var nFound2 = -1;

            for(var n2 = n1 + 1; n2 < g_anColumnsStart.length; ++ n2)
            {
                var nIdx2 = g_t_anIdxColumnsCount[n2];
                if (g_t_anColumnsCount[nIdx2] < 5)
                    break;

                if (anSelected[n2] != 0)
                    continue;

                if((nIdx2 != (nIdx1 + 1)) && (nIdx2 != (nIdx1 - 1)))
                {
                    var bFound = true;

                    if ((nIdx2 % 2) == 0)
                    {
                        if ((nIdx2 == nIdx1 + 2) || (nIdx2 == nIdx1 - 2))
                            bFound = false;
                    }

                    if (bFound)
                    {
                        nFound2 = nIdx2;
                        anSelected[n2] = 1;
                        break;
                    }
                }
            }

            if (nFound2 > 0)
            {
                anSelected[n1] = 1;

                var pair = new CPair();
                pair.value1 = nFound1;
                pair.value2 = nFound2;

                aPair.push(pair);
            }
        }
    }

    function Show_Columns()
    {
        var aPair = [];
        CheckHighlightColumns(aPair);

        var div = document.getElementById("divColumns");
        var strHtml = "";
        var bFirst = true;
        
        /*
        for(var n = 0; n < g_anColumnsStart.length; ++ n)
        {
            if (!bFirst)
                strHtml += "&nbsp;";
            bFirst = false;

            if (n == 6)
                strHtml += "<br>";

            strHtml += "<span class='" + ((anStatus[n] == 0) ? "ColumnNormal" : "ColumnHighlight") + "'>";
            strHtml += "&nbsp;" + GetColumnSpec(g_t_anIdxColumnsCount[n]) + "&nbsp;<span class='ColumnsCount'>" + g_t_anColumnsCount[g_t_anIdxColumnsCount[n]].toString() + "</span>&nbsp;</span>";
        }
        */

        for (var n = 0; n < aPair.length; ++n)
        {
            if ((n != 0) && ((n % 2) == 0))
                strHtml += "<br>";
            else if (!bFirst)
                strHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";

            bFirst = false;


            strHtml += "[&nbsp;" + GetColumnSpec(aPair[n].value1) + "&nbsp;<span class='ColumnsCount'>" + g_t_anColumnsCount[aPair[n].value1].toString() + "</span>&nbsp;&nbsp;&nbsp;";
            strHtml += "&nbsp;" + GetColumnSpec(aPair[n].value2) + "&nbsp;<span class='ColumnsCount'>" + g_t_anColumnsCount[aPair[n].value2].toString() + "</span>&nbsp;]";
        }

        var bShow = true;

        if (aPair.length <= 0)
        {
            bShow = false;
            bFirst = true;
            for(var n = 0; n < g_t_anColumnsCount.length; ++ n)
            {
                if (g_t_anColumnsCount[g_t_anIdxColumnsCount[n]] < 10)
                    break;

                bShow = true;

                if ((n != 0) && ((n % 3) == 0))
                    strHtml += "<br>";
                else if (!bFirst)
                    strHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                bFirst = false;

                strHtml += "&nbsp;" + GetColumnSpec(g_t_anIdxColumnsCount[n]) + "&nbsp;<span class='ColumnsCount'>" + g_t_anColumnsCount[g_t_anIdxColumnsCount[n]].toString() + "</span>&nbsp;";
            }
        }

        div.innerHTML = strHtml;

        if (bShow)
            div.style.display = (g_nColumnsStatus == 0) ? "none" : "";
        else
            div.style.display = "none";
    }

    function Show_StatsIntervals()
    {
        var divIntervals = document.getElementById("divStatsIntervals");
        var strHtml = "";

        if (g_nQueueIdx >= 0)
        {
            strHtml = "<table cellpadding='0' cellspacing='0' id='tblStatsIntervals'>";
            strHtml += "<tr onclick='OnShowStatsMisc()'><td>轮次</td><td>不出</td><td>概率</td>";
            for (var nn = 0; nn < g_StatsInterval.anFailedRound.length; ++nn)
            {
                strHtml += "<td>F" + g_StatsInterval.anFailedRound[nn].toString() + "</td><td>概率</td>";
            }
            strHtml += "</tr>";

            var nTotal = g_nQueueIdx + 1;

            for (var n = 0; n < g_StatsInterval.anRound.length; ++n)
            {
                strHtml += "<tr id='trStatsIntv" + n.toString() + "' onclick='OnStatsIntervalClick(true)'><td>" + g_StatsInterval.anRound[n].toString() + "</td>";
                strHtml += "<td>" + g_StatsInterval.anNotYetCount[n].toString() + "</td>";

                var percent1 = g_StatsInterval.anNotYetCount[n] * 100 / nTotal;
                strHtml += "<td>" + percent1.toFixed(1) + "%</td>";


                for (var nn = 0; nn < g_StatsInterval.anFailedRound.length; ++nn)
                {
                    strHtml += "<td>" + g_StatsInterval.anFailed[nn][n].toString() + "</td>";

                    var percent2 = 0;
                    if (g_StatsInterval.anNotYetCount[n] > 0)
                        percent2 = g_StatsInterval.anFailed[nn][n] * 100 / g_StatsInterval.anNotYetCount[n];
                    strHtml += "<td>" + percent2.toFixed(1) + "%</td>";
                }

                strHtml += "</tr>";
            }
            var strColSpan = (2 + g_StatsInterval.anFailedRound.length * 2).toString();

            strHtml += "<tr><td class='tdTotal'>" + nTotal.toString(); + "</td>"
            strHtml += "<td class='tdStatsInterval' colspan='" + strColSpan + "'>";
            strHtml += "<div id='divStatsInterval0' onclick='OnStatsIntervalListClick(0)'>";
            var bFirst = true;
            for (var n = 0; n < g_StatsInterval.anLargeCount.length; ++n)
            {
                if(g_StatsInterval.anLargeCount[n] > 0)
                {
                    if (!bFirst)
                        strHtml += ";&nbsp;";

                    bFirst = false;

                    var strNum = (n + 11).toString();
                    if (n == 19)
                        strNum += "及以上";
                    strHtml += strNum + "(" + g_StatsInterval.anLargeCount[n].toString() + ")";
                }
            }
            strHtml += "</div></td></tr><tr><td class='tdZero'>" + g_nNoZeroNumCount.toString() + "</td>";
            strHtml += "<td class='tdStatsInterval' colspan='" + strColSpan + "'>";
            strHtml += "<div id='divStatsInterval1' onclick='OnStatsIntervalListClick(1)'>";
            bFirst = true;
            var strNum = "";
            for (var n = g_StatsInterval.anZero.length - 1; n >= 0 ; --n)
            {
                if (!bFirst)
                    strHtml += ";&nbsp;";

                bFirst = false;
                if (g_StatsInterval.anZero[n] == 0)
                {
                    strNum = "<span class='txtZero'>" + g_StatsInterval.anZero[n].toString() + "</span>";
                }
                else
                {
                    strNum = g_StatsInterval.anZero[n].toString();
                }
                    
                strHtml += strNum;
            }
            strHtml += "</div></td></tr>"
            strHtml += "</table>";
        }

        divIntervals.innerHTML = strHtml;
        OnStatsIntervalClick(false);
    }

    function Show_Games()
    {
        var divGames = document.getElementById("divGames");
        if (g_nQueueIdx < 0)
        {
            divGames.innerHTML = "";
            return;
        }

        var strHtml = "<table cellpadding='0' cellspacing='0' class='tblGameSum'>";
        strHtml += "<tr id='trGameSumTitle'><td>名称</td><td>完成</td><td>赢</td><td>平</td><td>输</td><td>结算</td><td>实时</td><td>选择</td></tr>";
        for (var nn = 0; nn < g_aGameRule.length; ++nn)
        {
            strHtml += "<tr onclick='OnGameClick(" + nn.toString() + ")'><td onclick='OnGameClick(" + nn.toString() + ")'>";
            strHtml += g_aGameRule[g_aGame[nn].nIdxRule].strSpec;
            strHtml += "</td><td>"
            strHtml += g_aGame[nn].nCountCompleted.toString();
            strHtml += "</td><td class='tdWon'>"
            strHtml += g_aGame[nn].nCountWon.toString();
            strHtml += "</td><td class='tdDrew'>"
            strHtml += g_aGame[nn].nCountDrew.toString();
            strHtml += "</td><td class='tdLost'>"
            strHtml += g_aGame[nn].nCountLost.toString();
            strHtml += "</td><td>"
            strHtml += g_aGame[nn].nBalance.toString();
            strHtml += "</td><td>"
            strHtml += g_aGame[nn].nMoney.toString();
            strHtml += "</td>";
            strHtml += "<td>&nbsp;</td></tr>";
            strHtml += "<tr><td colspan='8'>";

            strHtml += "<table cellpadding='0' cellspacing='0' class='tblGame' id='tblGame" + nn.toString() + "' onclick='OnGameClick(" + nn.toString() + ")' ";
            strHtml += "style='display: " + ((g_aGame[nn].nShowStatus == 0) ? "none" : "") + "'>";
            strHtml += "<tr class='trTitle'><td>编号</td><td>距离</td><td>押</td><td>轮次</td><td>输赢</td><td>押中</td><td>状态</td></tr>";
            var nLastIdx = 0;
            if (g_aGame[nn].nCount > GAME_SHOW_ITEM_COUNT)
                nLastIdx = g_aGame[nn].nCount - GAME_SHOW_ITEM_COUNT;

            for (var n = g_aGame[nn].nCount - 1; n >= nLastIdx; --n)
            {
                var strCls = "trActive";
                if (g_aGame[nn].aItem[n].nStatus == 0) {
                    if (g_aGame[nn].aItem[n].nMoney > 0)
                        strCls = "trWon";
                    else if (g_aGame[nn].aItem[n].nMoney == 0)
                        strCls = "trDrew";
                    else
                        strCls = "trLost";
                }
                strHtml += "<tr class='trItems ";
                strHtml += strCls;
                strHtml += "'><td>" + (g_aGame[nn].aItem[n].nIdx + 1).toString() + "</td>";
                strHtml += "<td>" + g_aGame[nn].aItem[n].nDistance.toString() + "</td>";
                strHtml += "<td>" + GetColRowSpec(g_aGame[nn].aItem[n].nBet3C3R) + "</td>";
                strHtml += "<td>" + g_aGame[nn].aItem[n].nRound.toString() + "</td>";
                strHtml += "<td>" + g_aGame[nn].aItem[n].nMoney.toString() + "</td>";
                strHtml += "<td>" + ((g_aGame[nn].aItem[n].nHit == 1) ? "中" : "&nbsp;") + "</td>";
                strHtml += "<td>" + ((g_aGame[nn].aItem[n].nStatus == 0) ? "已结束" : "&nbsp;") + "</td>";
                strHtml += "</tr>";
            }
            strHtml += "</table>";
            strHtml += "</td></tr>";
        }
        strHtml += "</table>";
        divGames.innerHTML = strHtml;
    }

    function Show_RefreshTheme()
    {
        var strTitle = "淡雅";

        if(g_s_theme_id == 1)
        {
            strTitle = "彩色";
        }

        var bttn = document.getElementById("tdBttnTheme");
        bttn.innerHTML = strTitle;

        InitStyles();
        Show_3C3R();
        Show_Columns();
        Show_Queue();
        Show_RefreshSysButtons();
        Show_StatsIntervals();
        Show_Games();
    }

    function Show_InitSGButtons()
    {
        var strHtml = "<table cellpadding='0' cellspacing='5' border='0' id='tblSGButtons'><tr>";
        var nCount = STATS_GROUPS_COUNTS.length;
        for (var n = 0; n < nCount; ++n)
        {
            strHtml += "<td id='tdSGCount" + n.toString() + "' ";
            strHtml += "onclick='OnSGCountClick(" + n.toString() + ")'>";

            if (STATS_GROUPS_COUNTS[n] > 999)
                strHtml += "全部";
            else
                strHtml += STATS_GROUPS_COUNTS[n].toString();

            strHtml += "</td>";
        }
        strHtml += "</tr></table>";

        var td = document.getElementById("tdSGButtons");
        td.innerHTML = strHtml;

        Show_RefreshSGButtons();
    }

    function Show_InitSNCButtons()
    {
        strHtml = "<table cellpadding='0' cellspacing='5' border='0' id='tblSNCButtons'><tr>";
        var nCount = STATS_NUMCOUNT_COUNTS.length;
        for (var n = 0; n < nCount; ++n)
        {
            strHtml += "<td id='tdSNCCount" + n.toString() + "' ";
            strHtml += "onclick='OnSNCCountClick(" + n.toString() + ")'>";

            if (STATS_NUMCOUNT_COUNTS[n] > 999)
                strHtml += "全部";
            else
                strHtml += STATS_NUMCOUNT_COUNTS[n].toString();

            strHtml += "</td>";
        }
        strHtml += "</tr></table>";

        return strHtml;
    }

    function Show_RefreshSGButtons()
    {
        var nCount = STATS_GROUPS_COUNTS.length;
        var strBkColor = "";

        for (var n = 0; n < nCount; ++n)
        {
            if (n == g_nSGCountIdx)
                strBkColor = g_s_c_sg_bk_active;
            else
                strBkColor = "white";

            var td = document.getElementById("tdSGCount" + n.toString());
            td.style.backgroundColor = strBkColor;
        }
    }

    function Show_RefreshSNCButtons()
    {
        var nCount = STATS_NUMCOUNT_COUNTS.length;
        var strBkColor = "";

        for (var n = 0; n < nCount; ++n)
        {
            if (n == g_nSNCCountIdx)
                strBkColor = g_s_c_sg_bk_active;
            else
                strBkColor = "white";

            var td = document.getElementById("tdSNCCount" + n.toString());
            td.style.backgroundColor = strBkColor;
        }
    }

    function Show_3R3CLast2()
    {
        var strDisplay = "";

        if (g_nQueueIdx >= 0)
        {
            strDisplay = "none";
        }

        var td1 = document.getElementById("td3C3R4");
        var td2 = document.getElementById("td3C3R5");

        td1.style.display = strDisplay;
        td2.style.display = strDisplay;
    }

    function PageInit_Data()
    {
        g_nQueueIdx = -1;

        for (var n = 0; n < 6; ++n)
        {
            g_an3C3R[n] = 0;
            g_anIdx3C3R[n] = n;
        }

        InitStatsInterval();
        InitGame();
    }

    function PageInit_Show()
    {
        Show_Covers();

        Show_StatsGroupsCount();
        Show_StatsGroupAll();

        Show_InitSGButtons();

        Show_3R3CLast2();
        Show_Keyboard(true);
        Show_Games();

        Show_RefreshTheme();
    }

    function RefreshPage()
    {
        //window.location.reload();
        InitGlobalVariables();
        PageInit_Data();
        PageInit_Show();
    }

    // message handlers: ------------------------------------------------------

    function OnPageInit()
    {
        OnTest();

        InitGameRuleList();

        var nSGCountIdx = 1;
        var strSGCountIdx = GetCookie(COOKIE_SG_COUNT_IDX);
        if (strSGCountIdx.length > 0)
        {
            nSGCountIdx = parseInt(strSGCountIdx);
            if((nSGCountIdx < 0) || (nSGCountIdx >= STATS_GROUPS_COUNTS.length))
                nSGCountIdx = 1;
        }
        g_nSGCountIdx = nSGCountIdx;

        var strKeyboardID = "B";
        var strKeyboard = GetCookie(COOKIE_KEYBOARD_ID);
        if (strKeyboard.length == 1)
            strKeyboardID = strKeyboard;
        g_strKeyboardID = strKeyboardID;

        var nColumnsStatus = 0;
        var strColumnsStatus = GetCookie(COOKIE_COLUMNS_STATUS);
        if (strColumnsStatus.length > 0)
        {
            nColumnsStatus = parseInt(strColumnsStatus);
            if (nColumnsStatus != 0)
                nColumnsStatus = 1;
        }
        g_nColumnsStatus = nColumnsStatus;

        var nStatsIntervalStatus = 0;
        var strStatsIntervalStatus = GetCookie(COOKIE_STATSINTV_STATUS);
        if (strStatsIntervalStatus.length > 0)
        {
            nStatsIntervalStatus = parseInt(strStatsIntervalStatus);
            if ((nStatsIntervalStatus < 0) || (nStatsIntervalStatus > 2))
                nStatsIntervalStatus = 0;
        }
        g_nStatsIntervalStatus = nStatsIntervalStatus;

        var nStatsGroupStatus = 1;
        var strStatsGroupStatus = GetCookie(COOKIE_STATSGROUP_STATUS);
        if (strStatsGroupStatus.length > 0)
        {
            nStatsGroupStatus = parseInt(strStatsGroupStatus);
            if (nStatsGroupStatus != 0)
                nStatsGroupStatus = 1;
        }
        g_nStatsGroupStatus = nStatsGroupStatus;

        PageInit_Data();
        PageInit_Show();
    }

    function OnSwitchInput(nIdx)
    {
        var divK = document.getElementById("divKeyboard");
        var divB = document.getElementById("divGameBoard");

        if (nIdx == 0)
        {
            divK.style.display = "none";
            divB.style.display = "";
            g_strKeyboardID = "B";
        }
        else
        {
            divB.style.display = "none";
            divK.style.display = "";
            g_strKeyboardID = "K";
        }

        SetCookie(COOKIE_KEYBOARD_ID, g_strKeyboardID);
    }

    function OnShowColumnsClick()
    {
        var strDisplay = "";
        if(g_nColumnsStatus == 1)
        {
            g_nColumnsStatus = 0;
            strDisplay = "none";
        }
        else
        {
            g_nColumnsStatus = 1;
        }

        var div = document.getElementById("divColumns");
        div.style.display = strDisplay;

        SetCookie(COOKIE_COLUMNS_STATUS, g_nColumnsStatus);
    }

    function Calc_AddNum(num)
    {
        if (num != 0)
            g_nNoZeroNumCount++;

        // queue: -------------------------------

        if (g_nQueueIdx == (MAX_NUM_COUNT - 1))
        {
            for (var n = 0; n <= g_nQueueIdx - 1; ++n)
            {
                g_anQueueNum[n] = g_anQueueNum[n + 1];
            }
        }
        else
        {
            g_nQueueIdx++;
        }

        g_anQueueNum[g_nQueueIdx] = num;

        // 3C3R: --------------------------------

        Calc_3C3RAddNum(num);
        Sort(g_an3C3R, g_anIdx3C3R, false);
	
        // stats intervals: ---------------------

        g_StatsInterval.AddNum(num, true);

        // games: -------------------------------

        for (var n = 0; n < g_aGameRule.length; ++n)
        {
            g_aGame[n].AddNum(num);
        }
    }

    function Show_AddNum()
    {
        Show_Covers();
        Show_Queue();
        Show_3C3R();
        Calc_Columns();
        Show_Columns();
        Show_StatsIntervals();
        Calc_StatsGroupsCount();
        Show_StatsGroupsCount();
        Show_StatsGroupAll();
        Show_Games();
        Show_RefreshSysButtons();
        Show_3R3CLast2();
    }


    function OnAddNum(num)
    {
        Calc_AddNum(num);
        Show_AddNum();

        CalcAndShow_StatsMisc();

        SetCookie(COOKIE_BACKUP, GetNumString());
    }


    function OnDeleteNum()
    {
        if (g_nQueueIdx < 0)
            return;

        var num = g_anQueueNum[g_nQueueIdx];

        if (num != 0)
                g_nNoZeroNumCount--;

        if (g_nQueueIdx == 0)
        {
            RefreshPage();
            return;
        }

        Show_Covers();

        // stats intervals: ---------------------

        g_StatsInterval.DeleteNum(num);
       
        // games: -------------------------------

        for (var n = 0; n < g_aGameRule.length; ++n)
        {
            g_aGame[n].DeleteNum(num);
        }

        Calc_3C3RDeleteNum(num);

        // stats group count: -------------------

        Calc_StatsGroupsCount();
        Show_StatsGroupsCount();
        Show_StatsGroupAll();

        Sort(g_an3C3R, g_anIdx3C3R, false);

        Show_3C3R();
        Calc_Columns();
        Show_Columns();
        Show_Queue();
        Show_RefreshSysButtons();
        Show_StatsIntervals();
        Show_Games();

        Show_3R3CLast2();

        SetCookie(COOKIE_BACKUP, GetNumString());
    }

    function OnSysExpand()
    {
        g_nExpandStatus++;
        g_nExpandStatus = g_nExpandStatus % 2;

        Show_Queue();
        Show_RefreshSysButtons();
    }

    function OnSysRestart()
    {
        if (g_nQueueIdx < 0)
            return;
        
        var confirmed = confirm("确定要重新开始？");
        if (confirmed != 0)
        {
            RefreshPage();
        }
    }

    function OnSysChangeTheme()
    {
        if (g_s_theme_id > 1)
            return;

        if(g_s_theme_id == 0)
        {
            g_s_theme_id = 1;
        }
        else
        {
            g_s_theme_id = 0;
        }

        Show_RefreshTheme();
    }

    function Show_Keyboard(bShow)
    {
        g_nShowInputStatus = 1;
        var strDisplay = "";

        if (!bShow)
        {
            g_nShowInputStatus = 0;
            strDisplay = "none";
        }

        var strID = "divGameBoard";
        var strIDAnother = "divKeyboard";

        if (g_strKeyboardID == "K")
        {
            var strID = "divKeyboard";
            var strIDAnother = "divGameBoard";
        }

        var div = document.getElementById(strID);
        div.style.display = strDisplay;

        div = document.getElementById(strIDAnother);
        div.style.display = "none";

        var divKB = document.getElementById("divShowKeyboard");
        divKB.style.display = bShow ? "none" : "";
    }

    function OnShowKeyboardClick()
    {
        if(g_nShowInputStatus == 1)
        {
            Show_Keyboard(false);
        }
        else
        {
            Show_Keyboard(true);
        }

    }

    function OnHideKeyboard()
    {
        Show_Keyboard(false);
    }

    function OnShowKeyboard()
    {
        Show_Keyboard(true);
    }

    function OnStatsIntervalClick(bChange)
    {
        if (bChange)
        {
            g_nStatsIntervalStatus++;
            g_nStatsIntervalStatus = g_nStatsIntervalStatus % 3;
            SetCookie(COOKIE_STATSINTV_STATUS, g_nStatsIntervalStatus);
        }

        var tr1 = document.getElementById("trStatsIntv0");
        var tr2 = document.getElementById("trStatsIntv" + (g_StatsInterval.anRound.length - 1).toString());

        if(g_nStatsIntervalStatus == 0)
        {
            tr1.style.display = "";
            tr2.style.display = "";
        }
        else if(g_nStatsIntervalStatus == 1)
        {
            tr1.style.display = "none";
            tr2.style.display = "";
        }
        else
        {
            tr1.style.display = "none";
            tr2.style.display = "none";
        }
    }

    function OnStatsIntervalListClick(nID)
    {
        var C_EXPAND_HEIGHT = 150;
        var C_COLLAPSE_HEIGHT = 48;

        var nHeight = C_EXPAND_HEIGHT;

        for (var n = 0; n < g_StatsInterval.anExpandStatus.length; ++n)
        {
            if(n == nID)
            {
                if (g_StatsInterval.anExpandStatus[n] == 0)
                    g_StatsInterval.anExpandStatus[n] = 1;
                else
                    g_StatsInterval.anExpandStatus[n] = 0;
            }
            else
            {
                g_StatsInterval.anExpandStatus[n] = 0;
            }

            if (g_StatsInterval.anExpandStatus[n] == 1)
            {
                nHeight = C_EXPAND_HEIGHT;
                g_StatsInterval.nExpand = 0;
            }
            else
            {
                nHeight = C_COLLAPSE_HEIGHT;
            }

            var div = document.getElementById("divStatsInterval" + n.toString());
            div.style.height = nHeight;
        }
    }

    function Show_StatsGroupAll()
    {
        var strDisplay = "";

        if (g_nStatsGroupStatus == 0)
            strDisplay = "none";

        var tr = document.getElementById("trStatsGroupAll");
        tr.style.display = strDisplay;
    }


    function OnStatsGroupClick()
    {
        if (g_nStatsGroupStatus == 1)
            g_nStatsGroupStatus = 0;
        else
            g_nStatsGroupStatus = 1;

        SetCookie(COOKIE_STATSGROUP_STATUS, g_nStatsGroupStatus);

        Show_StatsGroupAll();
    }

    function OnSGCountClick(nIdx)
    {
        g_nSGCountIdx = nIdx;
        SetCookie(COOKIE_SG_COUNT_IDX, g_nSGCountIdx.toString());

        Show_RefreshSGButtons();

        Calc_StatsGroupsCount();
        Show_StatsGroupsCount();
        Show_StatsGroupAll();
    }

    function OnSNCCountClick(nIdx)
    {
        g_nSNCCountIdx = nIdx;

        Show_RefreshSNCButtons();
    }

    function OnGameClick(nGameIdx)
    {
        var bShow = false;

        var strDisplay = "";
        if(g_aGame[nGameIdx].nShowStatus == 1)
        {
            strDisplay = "none";
            g_aGame[nGameIdx].nShowStatus = 0;
        }
        else
        {
            bShow = true;
            g_aGame[nGameIdx].nShowStatus = 1;
        }

        if (bShow)
        {
            for (var n = 0; n < g_aGameRule.length; ++n)
            {
                if (n == nGameIdx)
                    continue;

                if (g_aGame[n].nShowStatus == 1)
                {
                    var tblOther = document.getElementById("tblGame" + n.toString());
                    g_aGame[n].nShowStatus = 0;
                    tblOther.style.display = "none";
                }
            }
        }

        var tbl = document.getElementById("tblGame" + nGameIdx.toString());
        tbl.style.display = strDisplay;
    }

    function OnSysRestore()
    {
        if (g_nQueueIdx >= 0)
            return;

        var strBackup = GetCookie(COOKIE_BACKUP);
        DoImport(strBackup, true);
    }

    function GetNumString()
    {
        var strExport = "";
        var bFirst = true;
        for (var n = 0; n <= g_nQueueIdx; ++n)
        {
            if (!bFirst)
                strExport += ",";
            bFirst = false;

            strExport += g_anQueueNum[n].toString();
        }

        return strExport;
    }

    function OnSysImportExport(bImport)
    {
        var tdTitle = document.getElementById("tdImportExportTitle");
        var txt = document.getElementById("txtClipboard");
        var trSpecImport = document.getElementById("trSpecImport");
        var trSpecExport = document.getElementById("trSpecExport");
        var tdBttnDoImport = document.getElementById("tdBttnDoImport");

        if (bImport)
        {
            tdTitle.innerHTML = "导&nbsp;&nbsp;&nbsp;入";
            txt.value = "";
            trSpecImport.style.display = "";
            trSpecExport.style.display = "none";
            tdBttnDoImport.style.display = "";
        }
        else
        {
            tdTitle.innerHTML = "导&nbsp;&nbsp;&nbsp;出";
            var strExport = GetNumString();

            txt.value = strExport;
            trSpecImport.style.display = "none";
            trSpecExport.style.display = "";
            tdBttnDoImport.style.display = "none";
        }

        var div = document.getElementById("divImportExport");
        div.style.display = "";
    }

    function OnImportExportOK()
    {
        var div = document.getElementById("divImportExport");
        div.style.display = "none";
    }

    function OnImport()
    {
        var txt = document.getElementById("txtClipboard");
        var strNumbers = txt.value;
        if (strNumbers.length <= 0)
        {
            alert("请在输入框中输入要导入的数据!");
            return;
        }

        if (DoImport(strNumbers, false))
            OnImportExportOK();
    }

    function DoImport(strNumbers, bFromCookie)
    {
        var astrNum = strNumbers.split(",");
        if ((strNumbers.length <= 0) || (astrNum.length <= 0))
        {
            if (bFromCookie)
                alert("没有找到数据！");
            else
                alert("请在输入框中输入要导入的数据！");

            return false;
        }

        var anNum = [];
        for (var n = 0; n < astrNum.length; ++n)
        {
            var nNum = parseInt(astrNum[n]);
            if (isNaN(nNum) || (nNum < 0) || (nNum > 36))
            {
                if (bFromCookie)
                    alert("数据不正确！");
                else
                    alert("要导入的数据不正确，请检查！");
                return false;
            }

            anNum[n] = nNum;
        }

        if (g_nQueueIdx >= 0)
        {
            var strMsg = "";
            if (bFromCookie)
                strMsg = "确定要恢复吗？";
            else
                strMsg = "导入操作将首先清空当前的数据，确实要导入吗？";

            var confirmed = confirm(strMsg);
            if (confirmed == 0)
                return false;
        }

        InitGlobalVariables();
        PageInit_Data();

        for (var n = 0; n < anNum.length; ++n)
            Calc_AddNum(anNum[n]);

        Show_AddNum();

        return true;
    }

    function Show_Covers()
    {
        var div = document.getElementById("divCover");

        var strDisplay = "";
        if (g_nEscapeStatus == 0)
        {
            strDisplay = "none";
        }
        else
        {
            var bFirst = true;
            var strHtml = "<div id='divNumbers'>";

            // 3C3R brief -----------------------

            for(var n = 0; n < 6; ++ n)
            {
                if (g_an3C3R[g_anIdx3C3R[n]].toString() < 5)
                    continue;

                if (!bFirst)
                    strHtml += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                bFirst = false;

                var strTitle = "";
                if (g_anIdx3C3R[n] == 0)
                    strTitle = "一";
                else if (g_anIdx3C3R[n] == 1)
                    strTitle = "二";
                else if (g_anIdx3C3R[n] == 2)
                    strTitle = "三";
                else
                    strTitle = (g_anIdx3C3R[n] - 2).toString();
                strHtml += strTitle + "&nbsp;(";
                strHtml += g_an3C3R[g_anIdx3C3R[n]].toString() + ")";
            }

            if(!bFirst)
                strHtml += "<br><br>";
            bFirst = true;

            // numbers --------------------------

            for(var n = g_nQueueIdx; n >= 0; --n)
            {
                if (!bFirst)
                    strHtml += ", ";
                bFirst = false;
                strHtml += g_anQueueNum[n].toString();
            }
            strHtml += "</div>";
            div.innerHTML = strHtml;
        }

        div.style.display = strDisplay;
    }

    function OnHidePopup()
    {
        var div = document.getElementById("divPopup");
        div.style.display = "none";

        g_nPopupStatsMiscStatus = 0;
    }

    function ShowPopup(strDivID, strTitle)
    {
        for(var n = 0; n < g_astrPopupDivID.length; ++n)
        {
            var div = document.getElementById(g_astrPopupDivID[n]);

            if (g_astrPopupDivID[n] != strDivID)
                div.style.display = "none";
            else
                div.style.display = "";
        }

        var td = document.getElementById("tdDivPopupTitle");
        td.innerHTML = strTitle;
    }

    function CalcAndShow_StatsMisc()
    {
        if (g_nPopupStatsMiscStatus == 0)
            return;

        var strHtml = "";

        // stats numbers :-----------------------------------------------------

        var anNumCount = [];
        var anNumCountIdx = [];
        for (var n = 0; n <= 36; ++n)
        {
            anNumCount[n] = 0;
            anNumCountIdx[n] = n;
        }

        var nStatsCount = STATS_NUMCOUNT_COUNTS[g_nSNCCountIdx];

        var nStart = 0;

        nStart = g_nQueueIdx - nStatsCount + 1;
        if (nStart < 0)
            nStart = 0;

        for (var n = g_nQueueIdx; n >= nStart; --n)
            anNumCount[g_anQueueNum[n]]++;

        Sort(anNumCount, anNumCountIdx, true);

        strHtml += "<table cellpadding='0' cellspacing='0' id='tblStatsNumCount'><tr>";
        for (var n = 0; n < 40; ++n)
        {
            if ((n != 0) && ((n % 4) == 0))
                strHtml += "</tr><tr>";

            var nIdx = 10 * (n % 4) + Math.floor(n / 4);
            var strT = "";
            var strV = "";
            if (nIdx <= 36)
            {
                strT = anNumCountIdx[nIdx].toString();
                strV = anNumCount[anNumCountIdx[nIdx]].toString();
            }
            else
            {
                strT = "&nbsp;"
                strV = "&nbsp;"
            }

            strHtml += "<td class='tdSFTitle'>" + strT + "</td>";
            strHtml += "<td>" + strV + "</td>";
        }

        strHtml += "</tr></table>";

        strHtml += Show_InitSNCButtons();

        // stats finally :-----------------------------------------------------

        var MAX_COUNT = 30;

        var anCount = [];
        var anCountAbove = [];
        var nCount30Above = 0;
        var nTotal = 0;
        var an3C3RPrevIdx = [];

        for(var nn = 0; nn < 6; ++ nn)
            an3C3RPrevIdx[nn] = -1;

        for (var nn = 0; nn < MAX_COUNT; ++nn)
            anCount[nn] = 0;

        for(var n = 0; n <= g_nQueueIdx; ++ n)
        {
            if (g_anQueueNum[n] == 0)
                continue;

            nTotal++;

            var nCol = GetNumCol(g_anQueueNum[n]);
            var nRow = GetNumRow(g_anQueueNum[n]);

            var nGap = n - an3C3RPrevIdx[nCol] - 1;
            if (nGap < MAX_COUNT)
                anCount[nGap]++;
            else
                nCount30Above++;

            an3C3RPrevIdx[nCol] = n;

            nGap = n - an3C3RPrevIdx[nRow + 3] - 1;
            if (nGap < MAX_COUNT)
                anCount[nGap]++;
            else
                nCount30Above++;
            an3C3RPrevIdx[nRow + 3] = n;
        }

        anCountAbove[MAX_COUNT - 1] = anCount[MAX_COUNT - 1] + nCount30Above;

        for (var n = MAX_COUNT - 2; n >= 0; --n)
            anCountAbove[n] = anCount[n] + anCountAbove[n + 1];

        var BIG_COL_COUNT = 2;
        var EACH_COL_COUNT = MAX_COUNT / BIG_COL_COUNT;

        strHtml += "<table cellpadding='0' cellspacing='0' id='tblStatsFinally'><tr>";
        for (var n = 0; n < MAX_COUNT; ++n)
        {
            if ((n != 0) && ((n % BIG_COL_COUNT) == 0))
                strHtml += "</tr><tr>";

            var nIdx = EACH_COL_COUNT * (n % BIG_COL_COUNT) + Math.floor(n / BIG_COL_COUNT);

            strHtml += "<td class='tdSFTitle'>" + (nIdx + 1).toString() + ((nIdx == (MAX_COUNT - 1)) ? "+" : "") + "</td>";

            var nCount = anCount[nIdx];
            if (nIdx == (MAX_COUNT - 1))
                nCount += nCount30Above;

            strHtml += "<td>" + nCount.toString() + "</td>";

            var strPercent = "0";
            if (nTotal > 0)
                strPercent = (anCount[nIdx] * 50 / nTotal).toFixed(1).toString();

            strHtml += "<td class='tdSFPercent'>" + strPercent + "%</td>";

            strHtml += "<td>" + anCountAbove[nIdx].toString() + "</td>";

            strPercent = "0";
            if (nTotal > 0)
                strPercent = (anCountAbove[nIdx] * 50 / nTotal).toFixed(1).toString();

            strHtml += "<td class='tdSFPercent'>" + strPercent + "%</td>";
        }
        strHtml += "</tr></table>";

        var div = document.getElementById("divStatsMisc");
        div.innerHTML = strHtml;

        //Show_RefreshSNCButtons();
    }

    function OnShowStatsMisc()
    {
        g_nPopupStatsMiscStatus = 1;

        CalcAndShow_StatsMisc();

        ShowPopup("divStatsMisc", "统计数据");

        var div = document.getElementById("divPopup");
        div.style.display = "";
    }

    function OnEscape()
    {
        g_nEscapeStatus++;
        g_nEscapeStatus = g_nEscapeStatus % 2;

        Show_Covers();
    }

</script>

</head>
<body onload="OnPageInit()" style="padding: 0; margin :0; background-color: white">
    <div style="position:fixed; z-index: 999; right: 0px; top:0px; 
        width: 100%; height: 100%; background-color: white" id="divCover"></div>
    <div style="position:fixed; z-index: 99; right: 0px; top:0px; width: 100%; background-color: white" 
         onclick="OnShowColumnsClick()">
        <div style="padding: 12px 8px">
            <table cellpadding="0" cellspacing="0" border="0" id="tblStatistics">
                <tr>
                    <td class="title_c" id="tdT3C3R0">第1组</td>
                    <td class="value_c" id="td3C3R0">0</td>
                    <td class="space_c">&nbsp;</td>
                    <td class="title_c" id="tdT3C3R1">第2组</td>
                    <td class="value_c" id="td3C3R1">0</td>
                    <td class="space_c">&nbsp;</td>
                    <td class="title_c" id="tdT3C3R2">第3组</td>
                    <td class="value_c" id="td3C3R2">0</td>
                    <td class="space_c">&nbsp;</td>
                    <td class="title_c" id="tdT3C3R3">第1行</td>
                    <td class="value_c" id="td3C3R3">0</td>
                    <td class="space_c">&nbsp;</td>
                    <td class="title_c" id="tdT3C3R4">第2行</td>
                    <td class="value_c" id="td3C3R4">0</td>
                    <td class="space_c">&nbsp;</td>
                    <td class="title_c" id="tdT3C3R5">第3行</td>
                    <td class="value_c" id="td3C3R5">0</td>
                </tr>
            </table>
        </div>
    </div>
    <div id="divPopup" style="position:absolute; z-index:900; top: 0px; padding: 0; margin: 0; 
        width: 100%; height: 3000px; background-color: white; display: none;">
        <div style="width: 100%; height: 10px">&nbsp;</div>
        <table cellpadding="0" cellspacing="0" style="width: 100%;" id="tblDivPopupTitleBar">
            <tr>
                <td style="width: 91%; text-align: center" id="tdDivPopupTitle">&nbsp;</td>
                <td style="width: 9%; height: 80px; font-family: Arial" onclick="OnHidePopup()">x</td>
            </tr>
        </table>
        <div id="divStatsMisc"></div>
    </div>
    <div style="position:absolute; z-index:0; top: 90px; padding: 0; margin: 0; width: 100%">
        <div style="height: 8px" id="divBlank"></div>
        <div id="divColumns" onclick="OnShowColumnsClick()"></div>
        <table cellpadding="0" cellspacing="5" border="0" id="tblQueue" onclick="OnSysExpand()">
            <tr id="trRow1">
                <td id="td0"></td><td id="td1"></td><td id="td2"></td><td id="td3"></td><td id="td4"></td>
                <td id="td5"></td><td id="td6"></td><td id="td7"></td><td id="td8"></td><td id="td9"></td>
                <td id="td10"></td><td id="td11"></td><td id="td12"></td><td id="td13"></td><td id="td14"></td>
            </tr>
            <tr id="trRow2">
                <td id="td15"></td><td id="td16"></td><td id="td17"></td><td id="td18"></td><td id="td19"></td>
                <td id="td20"></td><td id="td21"></td><td id="td22"></td><td id="td23"></td><td id="td24"></td>
                <td id="td25"></td><td id="td26"></td><td id="td27"></td><td id="td28"></td><td id="td29"></td>
            </tr>
            <tr id="trRow3">
                <td id="td30"></td><td id="td31"></td><td id="td32"></td><td id="td33"></td><td id="td34"></td>
                <td id="td35"></td><td id="td36"></td><td id="td37"></td><td id="td38"></td><td id="td39"></td>
                <td id="td40"></td><td id="td41"></td><td id="td42"></td><td id="td43"></td><td id="td44"></td>
            </tr>
            <tr id="trRow4">
                <td id="td45"></td><td id="td46"></td><td id="td47"></td><td id="td48"></td><td id="td49"></td>
                <td id="td50"></td><td id="td51"></td><td id="td52"></td><td id="td53"></td><td id="td54"></td>
                <td id="td55"></td><td id="td56"></td><td id="td57"></td><td id="td58"></td><td id="td59"></td>
            </tr>
            <tr id="trRow5">
                <td id="td60"></td><td id="td61"></td><td id="td62"></td><td id="td63"></td><td id="td64"></td>
                <td id="td65"></td><td id="td66"></td><td id="td67"></td><td id="td68"></td><td id="td69"></td>
                <td id="td70"></td><td id="td71"></td><td id="td72"></td><td id="td73"></td><td id="td74"></td>
            </tr>
            <tr id="trRow6">
                <td id="td75"></td><td id="td76"></td><td id="td77"></td><td id="td78"></td><td id="td79"></td>
                <td id="td80"></td><td id="td81"></td><td id="td82"></td><td id="td83"></td><td id="td84"></td>
                <td id="td85"></td><td id="td86"></td><td id="td87"></td><td id="td88"></td><td id="td89"></td>
            </tr>
            <tr id="trRow7">
                <td id="td90"></td><td id="td91"></td><td id="td92"></td><td id="td93"></td><td id="td94"></td>
                <td id="td95"></td><td id="td96"></td><td id="td97"></td><td id="td98"></td><td id="td99"></td>
                <td id="td100" colspan="5">&nbsp;</td>
            </tr>
        </table>
        <div style="height: 8px"></div>

        <table cellpadding="0" cellspacing="10" border="0" style="width: 100%">
            <tr>
                <td id="tdBttnTheme" class="bttn" onclick="OnSysChangeTheme()">NA</td>
                <td id="tdBttnRestart" class="bttn" onclick="OnSysRestart()">重置</td>
                <td id="tdBttnDelete" class="bttn" onclick="OnDeleteNum()">删除</td>
                <td id="tdBttnRestore" class="bttn" onclick="OnSysRestore()">恢复</td>
                <td id="tdBttnExport" class="bttn" onclick="OnSysImportExport(false)">导出</td>
                <td id="tdBttnImport" class="bttn" onclick="OnSysImportExport(true)">导入</td>
                <td id="tdBttnStatsFinally" class="bttn" onclick="OnShowStatsMisc()">统计</td>
            </tr>
        </table>

        <div style="height: 18px"></div>
        <div id="divStatsIntervals"></div>

        <div id="divStatsGroups" style="display: none">
            <div style="height: 13px"></div>
            <table cellpadding="0" cellspacing="0" id="tblStatsGroups">
                <tr onclick="OnStatsGroupClick()">
                    <td id="tdStatsGroupsCol" width="53%" style="border-right: 1px solid #8f8f8f"></td>
                    <td id="tdStatsGroupsRow"></td>
                </tr>
                <tr id="trStatsGroupAll" onclick="OnStatsGroupClick()"><td id="tdStatsGroupsAll" colspan="2"></td></tr>
                <tr><td id="tdSGButtons" colspan="2"></td></tr>
            </table>
        </div>

        <div style="height: 13px"></div>
        <div id="divGames"></div>

    </div>
    <div id="divKeyboard" style="position:fixed; bottom: 0px; z-index:3003; width: 100%;">
        <div class="kbspace1">&nbsp;</div>
        <div class="kbspace2">&nbsp;</div>
        <table cellpadding="0" cellspacing="0" id="tblKeyboard">
            <tr>
                <td id="tdK1" onclick="OnAddNum(1)">1</td><td id="tdK2" onclick="OnAddNum(2)">2</td><td id="tdK3" onclick="OnAddNum(3)">3</td>
                <td id="tdK4" onclick="OnAddNum(4)">4</td><td id="tdK5" onclick="OnAddNum(5)">5</td><td id="tdK6" onclick="OnAddNum(6)">6</td>
                <td id="tdK7" onclick="OnAddNum(7)">7</td><td id="tdK8" onclick="OnAddNum(8)">8</td><td id="tdK9" onclick="OnAddNum(9)">9</td>
            </tr>
            <tr>
                <td id="tdK10" onclick="OnAddNum(10)">10</td><td id="tdK11" onclick="OnAddNum(11)">11</td><td id="tdK12" onclick="OnAddNum(12)">12</td>
                <td id="tdK13" onclick="OnAddNum(13)">13</td><td id="tdK14" onclick="OnAddNum(14)">14</td><td id="tdK15" onclick="OnAddNum(15)">15</td>
                <td id="tdK16" onclick="OnAddNum(16)">16</td><td id="tdK17" onclick="OnAddNum(17)">17</td><td id="tdK18" onclick="OnAddNum(18)">18</td>
            </tr>
            <tr>
                <td id="tdK19" onclick="OnAddNum(19)">19</td><td id="tdK20" onclick="OnAddNum(20)">20</td><td id="tdK21" onclick="OnAddNum(21)">21</td>
                <td id="tdK22" onclick="OnAddNum(22)">22</td><td id="tdK23" onclick="OnAddNum(23)">23</td><td id="tdK24" onclick="OnAddNum(24)">24</td>
                <td id="tdK25" onclick="OnAddNum(25)">25</td><td id="tdK26" onclick="OnAddNum(26)">26</td><td id="tdK27" onclick="OnAddNum(27)">27</td>
            </tr>
            <tr>
                <td id="tdK28" onclick="OnAddNum(28)">28</td><td id="tdK29" onclick="OnAddNum(29)">29</td><td id="tdK30" onclick="OnAddNum(30)">30</td>
                <td id="tdK31" onclick="OnAddNum(31)">31</td><td id="tdK32" onclick="OnAddNum(32)">32</td><td id="tdK33" onclick="OnAddNum(33)">33</td>
                <td id="tdK34" onclick="OnAddNum(34)">34</td><td id="tdK35" onclick="OnAddNum(35)">35</td><td id="tdK36" onclick="OnAddNum(36)">36</td>
            </tr>
            <tr>
                <td id="tdKEsc" onclick="OnEscape()" colspan="2">esc</td>
                <td id="tdK0" onclick="OnAddNum(0)" colspan="4">0</td>
                <td id="tdKSwitch" onclick="OnSwitchInput(0)" colspan="2">switch</td>
                <td id="tdKHide" class="tdHide" onclick="OnHideKeyboard()">x</td>
            </tr>
        </table>
    </div>
    <div id="divGameBoard" style="position:fixed; bottom: 0px; z-index:3002; width: 100%;">
        <div class="kbspace1">&nbsp;</div>
        <div class="kbspace2">&nbsp;</div>
        <table cellpadding="0" cellspacing="0" id="tblGameBoard">
            <tr>
                <td id="tdB3" onclick="OnAddNum(3)">3</td><td id="tdB6" onclick="OnAddNum(6)">6</td><td id="tdB9" onclick="OnAddNum(9)">9</td>
                <td id="tdB12" onclick="OnAddNum(12)">12</td><td id="tdB15" onclick="OnAddNum(15)">15</td><td id="tdB18" onclick="OnAddNum(18)">18</td>
                <td id="tdB21" onclick="OnAddNum(21)">21</td><td id="tdB24" onclick="OnAddNum(24)">24</td><td id="tdB27" onclick="OnAddNum(27)">27</td>
                <td id="tdB30" onclick="OnAddNum(30)">30</td><td id="tdB33" onclick="OnAddNum(33)">33</td><td id="tdB36" onclick="OnAddNum(36)">36</td>
            </tr>
            <tr>
                <td id="tdB2" onclick="OnAddNum(2)">2</td><td id="tdB5" onclick="OnAddNum(5)">5</td><td id="tdB8" onclick="OnAddNum(8)">8</td>
                <td id="tdB11" onclick="OnAddNum(11)">11</td><td id="tdB14" onclick="OnAddNum(14)">14</td><td id="tdB17" onclick="OnAddNum(17)">17</td>
                <td id="tdB20" onclick="OnAddNum(20)">20</td><td id="tdB23" onclick="OnAddNum(23)">23</td><td id="tdB26" onclick="OnAddNum(26)">26</td>
                <td id="tdB29" onclick="OnAddNum(29)">29</td><td id="tdB32" onclick="OnAddNum(32)">32</td><td id="tdB35" onclick="OnAddNum(35)">35</td>
            </tr>
            <tr>
                <td id="tdB1" onclick="OnAddNum(1)">1</td><td id="tdB4" onclick="OnAddNum(4)">4</td><td id="tdB7" onclick="OnAddNum(7)">7</td>
                <td id="tdB10" onclick="OnAddNum(10)">10</td><td id="tdB13" onclick="OnAddNum(13)">13</td><td id="tdB16" onclick="OnAddNum(16)">16</td>
                <td id="tdB19" onclick="OnAddNum(19)">19</td><td id="tdB22" onclick="OnAddNum(22)">22</td><td id="tdB25" onclick="OnAddNum(25)">25</td>
                <td id="tdB28" onclick="OnAddNum(28)">28</td><td id="tdB31" onclick="OnAddNum(31)">31</td><td id="tdB34" onclick="OnAddNum(34)">34</td>
            </tr>
            <tr>
                <td id="tdBEsc" onclick="OnEscape()" colspan="2">esc</td>
                <td id="tdB0" onclick="OnAddNum(0)" colspan="6">0</td>
                <td id="tdBSwitch" onclick="OnSwitchInput(1)" colspan="3">switch</td>
                <td id="tdBHide" class="tdHide" onclick="OnHideKeyboard()">x</td>
            </tr>
        </table>
    </div>
    <div id="divShowKeyboard" style="position:fixed; right: 0px; bottom: 0px; z-index:3001; width: 100px; height: 100px; display:none" onclick="OnShowKeyboard()"></div>
    <div id="divImportExport" style="display: none;">
        <table cellpadding="0" cellspacing="30" style="width: 100%" id="tblImportExport">
            <tr><td>&nbsp;</td></tr>
            <tr><td id="tdImportExportTitle"></td></tr>
            <tr id="trSpecImport"><td class="tdSpec">请在下面编辑框内准备好需要导入的数据，然后按导入：</td></tr>
            <tr id="trSpecExport"><td class="tdSpec">请把下面编辑框的内容复制到剪贴板，然后导出：</td></tr>
            <tr><td id="tdTxt"><textarea style="width: 100%; height: 600px" id="txtClipboard"></textarea></td></tr>
            <tr>
                <td style="text-align: center">
                    <table cellpadding="0" cellspacing="20" border="0" style="margin: auto" id="tblPanelButtons">
                        <tr>
                            <td class="bttn bttnImportExport" id="tdBttnDoImport" onclick="OnImport()">导入</td>
                            <td class="bttn bttnImportExport" onclick="OnImportExportOK()">退出</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>
